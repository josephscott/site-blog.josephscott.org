{
    "version": "https://jsonfeed.org/version/1.1",
    "user_comment": "This feed allows you to read the posts from this site in any feed reader that supports the JSON Feed format. To add this feed to your reader, copy the following URL -- https://blog.josephscott.org/tag/curl_http_request/feed/json/ -- and add it your reader.",
    "home_page_url": "https://blog.josephscott.org/tag/curl_http_request/",
    "feed_url": "https://blog.josephscott.org/tag/curl_http_request/feed/json/",
    "language": "en-US",
    "title": "curl_http_request &#8211; Joseph Scott",
    "items": [
        {
            "id": "http://josephscott.org/?p=2029",
            "url": "https://blog.josephscott.org/2010/03/17/php-helpers-curl_http_request/",
            "title": "PHP Helpers: curl_http_request",
            "content_html": "<p><a href=\"http://curl.haxx.se/\">cURL</a> is one very handy program and library, I love having access to in PHP.  It has a ton of options though, and I can never seem to remember to flip the right knobs without reviewing the options list.  99% of the time I just want a simple function that does the right thing when making an HTTP request.  So here&#8217;s the new PHP Helpers function that sets up reasonable defaults for making HTTP requests using cURL:</p>\n<p>[sourcecode lang=&#8221;php&#8221;]<br />\nif ( !function_exists( &#8216;curl_http_request&#8217; ) ) {<br />\n    function curl_http_request( $url, $req = &#8216;GET&#8217;, $arg = array( ) ) {<br />\n        $body       = &#8221;;<br />\n        $cookies    = array( );<br />\n        $err_no     = 0;<br />\n        $err_msg    = &#8221;;<br />\n        $headers    = array( );<br />\n        $info       = array( );</p>\n<p>        $opt = array(<br />\n            &#8216;connect_timeout&#8217;   =&gt; 5,<br />\n            &#8216;cookies&#8217;           =&gt; array( ),<br />\n            &#8216;follow_location&#8217;   =&gt; TRUE,<br />\n            &#8216;http_headers&#8217;      =&gt; array( ),<br />\n            &#8216;max_redirects&#8217;     =&gt; 5,<br />\n            &#8216;timeout&#8217;           =&gt; 15,<br />\n            &#8216;password&#8217;          =&gt; &#8221;,<br />\n            &#8216;post_fields&#8217;       =&gt; array( ),<br />\n            &#8216;user_agent&#8217;        =&gt; &#8216;PHP curl_http_get&#8217;,<br />\n            &#8216;username&#8217;          =&gt; &#8221;,<br />\n            &#8216;verify_ssl&#8217;        =&gt; TRUE<br />\n        );<br />\n        foreach ( $opt as $k =&gt; $v ) {<br />\n            if ( isset( $arg[$k] ) ) {<br />\n                $opt[$k] = $arg[$k];<br />\n            }<br />\n        }</p>\n<p>        $curl_opt = array(<br />\n            CURLOPT_AUTOREFERER     =&gt; TRUE,<br />\n            CURLOPT_CONNECTTIMEOUT  =&gt; $opt[&#8216;connect_timeout&#8217;],<br />\n            CURLOPT_CUSTOMREQUEST   =&gt; $req,<br />\n            CURLOPT_ENCODING        =&gt; &#8221;,<br />\n            CURLOPT_FOLLOWLOCATION  =&gt; $opt[&#8216;follow_location&#8217;],<br />\n            CURLOPT_HEADER          =&gt; TRUE,<br />\n            CURLOPT_MAXREDIRS       =&gt; $opt[&#8216;max_redirects&#8217;],<br />\n            CURLOPT_RETURNTRANSFER  =&gt; TRUE,<br />\n            CURLOPT_TIMEOUT         =&gt; $opt[&#8216;timeout&#8217;],<br />\n            CURLOPT_USERAGENT       =&gt; $opt[&#8216;user_agent&#8217;],<br />\n        );</p>\n<p>        if (<br />\n            is_array( $opt[&#8216;cookies&#8217;] )<br />\n            &amp;&amp; count( $opt[&#8216;cookies&#8217;] ) &gt; 0<br />\n        ) {<br />\n            $curl_opt[CURLOPT_COOKIE] = implode( &#8216;;&#8217;, $opt[&#8216;cookies&#8217;] );<br />\n        }</p>\n<p>        if ( !empty( $opt[&#8216;username&#8217;] ) ) {<br />\n            $curl_opt[CURLOPT_USERPWD] = $opt[&#8216;username&#8217;] . &#8216;:&#8217; . $opt[&#8216;password&#8217;];<br />\n        }</p>\n<p>        if (<br />\n            is_array( $opt[&#8216;post_fields&#8217;] )<br />\n            &amp;&amp; count( $opt[&#8216;post_fields&#8217;] ) &gt; 0<br />\n        ) {<br />\n            $curl_opt[CURLOPT_POST] = TRUE;<br />\n            $curl_opt[CURLOPT_POSTFIELDS] = $opt[&#8216;post_fields&#8217;];<br />\n        }</p>\n<p>        if ( $req == &#8216;HEAD&#8217; ) {<br />\n            $curl_opt[CURLOPT_NOBODY] = TRUE;<br />\n        }</p>\n<p>        if (<br />\n            is_array( $opt[&#8216;http_headers&#8217;] )<br />\n            &amp;&amp; count( $opt[&#8216;http_headers&#8217;] ) &gt; 0<br />\n        ) {<br />\n            $curl_opt[CURLOPT_HTTPHEADER] = $opt[&#8216;http_headers&#8217;];<br />\n        }</p>\n<p>        if ( $opt[&#8216;verify_ssl&#8217;] === FALSE ) {<br />\n            $curl_opt[CURLOPT_SSL_VERIFYPEER] = FALSE;<br />\n            $curl_opt[CURLOPT_SSL_VERIFYHOST] = 0;<br />\n        }</p>\n<p>        $curl = curl_init( $url );<br />\n        curl_setopt_array( $curl, $curl_opt );</p>\n<p>        $body       = curl_exec( $curl );<br />\n        $err_no     = curl_errno( $curl );<br />\n        $err_msg    = curl_error( $curl );<br />\n        $info       = curl_getinfo( $curl );<br />\n        curl_close( $curl );</p>\n<p>        $header_string = trim( substr( $body, 0, $info[&#8216;header_size&#8217;] ) );<br />\n        $body = substr( $body, $info[&#8216;header_size&#8217;] );</p>\n<p>        if ( strpos( $header_string, &quot;rnrn&quot; ) !== FALSE ) {<br />\n            $header_string = end( explode( &quot;rnrn&quot;, $header_string ) );<br />\n            $header_string = str_replace( &quot;rn&quot;, &quot;n&quot;, $header_string );<br />\n        }</p>\n<p>        foreach ( explode( &quot;n&quot;, $header_string ) as $line ) {<br />\n            list( $k, $v ) = explode( &#8216;:&#8217;, $line, 2 );<br />\n            if ( empty( $v ) ) {<br />\n                continue;<br />\n            }</p>\n<p>            if ( strtolower( $k ) == &#8216;set-cookie&#8217; ) {<br />\n                $cookies[] = trim( $v );<br />\n            } else {<br />\n                $headers[$k] = trim( $v );<br />\n            }<br />\n        }</p>\n<p>        return array(<br />\n            &#8216;body&#8217;      =&gt; $body,<br />\n            &#8216;err_no&#8217;    =&gt; $err_no,<br />\n            &#8216;err_msg&#8217;   =&gt; $err_msg,<br />\n            &#8216;headers&#8217;   =&gt; $headers,<br />\n            &#8216;cookies&#8217;   =&gt; $cookies,<br />\n            &#8216;info&#8217;      =&gt; $info<br />\n        );<br />\n    } // function curl_http_request<br />\n}<br />\n[/sourcecode]</p>\n<p>It&#8217;s a bit longer that then other PHP Helper functions <img src=\"https://s.w.org/images/core/emoji/13.0.1/72x72/1f642.png\" alt=\"\ud83d\ude42\" class=\"wp-smiley\" style=\"height: 1em; max-height: 1em;\" /> .</p>\n",
            "content_text": "cURL is one very handy program and library, I love having access to in PHP.  It has a ton of options though, and I can never seem to remember to flip the right knobs without reviewing the options list.  99% of the time I just want a simple function that does the right thing when making an HTTP request.  So here&#8217;s the new PHP Helpers function that sets up reasonable defaults for making HTTP requests using cURL:\n[sourcecode lang=&#8221;php&#8221;]\nif ( !function_exists( &#8216;curl_http_request&#8217; ) ) {\n    function curl_http_request( $url, $req = &#8216;GET&#8217;, $arg = array( ) ) {\n        $body       = &#8221;;\n        $cookies    = array( );\n        $err_no     = 0;\n        $err_msg    = &#8221;;\n        $headers    = array( );\n        $info       = array( );\n        $opt = array(\n            &#8216;connect_timeout&#8217;   =&gt; 5,\n            &#8216;cookies&#8217;           =&gt; array( ),\n            &#8216;follow_location&#8217;   =&gt; TRUE,\n            &#8216;http_headers&#8217;      =&gt; array( ),\n            &#8216;max_redirects&#8217;     =&gt; 5,\n            &#8216;timeout&#8217;           =&gt; 15,\n            &#8216;password&#8217;          =&gt; &#8221;,\n            &#8216;post_fields&#8217;       =&gt; array( ),\n            &#8216;user_agent&#8217;        =&gt; &#8216;PHP curl_http_get&#8217;,\n            &#8216;username&#8217;          =&gt; &#8221;,\n            &#8216;verify_ssl&#8217;        =&gt; TRUE\n        );\n        foreach ( $opt as $k =&gt; $v ) {\n            if ( isset( $arg[$k] ) ) {\n                $opt[$k] = $arg[$k];\n            }\n        }\n        $curl_opt = array(\n            CURLOPT_AUTOREFERER     =&gt; TRUE,\n            CURLOPT_CONNECTTIMEOUT  =&gt; $opt[&#8216;connect_timeout&#8217;],\n            CURLOPT_CUSTOMREQUEST   =&gt; $req,\n            CURLOPT_ENCODING        =&gt; &#8221;,\n            CURLOPT_FOLLOWLOCATION  =&gt; $opt[&#8216;follow_location&#8217;],\n            CURLOPT_HEADER          =&gt; TRUE,\n            CURLOPT_MAXREDIRS       =&gt; $opt[&#8216;max_redirects&#8217;],\n            CURLOPT_RETURNTRANSFER  =&gt; TRUE,\n            CURLOPT_TIMEOUT         =&gt; $opt[&#8216;timeout&#8217;],\n            CURLOPT_USERAGENT       =&gt; $opt[&#8216;user_agent&#8217;],\n        );\n        if (\n            is_array( $opt[&#8216;cookies&#8217;] )\n            &amp;&amp; count( $opt[&#8216;cookies&#8217;] ) &gt; 0\n        ) {\n            $curl_opt[CURLOPT_COOKIE] = implode( &#8216;;&#8217;, $opt[&#8216;cookies&#8217;] );\n        }\n        if ( !empty( $opt[&#8216;username&#8217;] ) ) {\n            $curl_opt[CURLOPT_USERPWD] = $opt[&#8216;username&#8217;] . &#8216;:&#8217; . $opt[&#8216;password&#8217;];\n        }\n        if (\n            is_array( $opt[&#8216;post_fields&#8217;] )\n            &amp;&amp; count( $opt[&#8216;post_fields&#8217;] ) &gt; 0\n        ) {\n            $curl_opt[CURLOPT_POST] = TRUE;\n            $curl_opt[CURLOPT_POSTFIELDS] = $opt[&#8216;post_fields&#8217;];\n        }\n        if ( $req == &#8216;HEAD&#8217; ) {\n            $curl_opt[CURLOPT_NOBODY] = TRUE;\n        }\n        if (\n            is_array( $opt[&#8216;http_headers&#8217;] )\n            &amp;&amp; count( $opt[&#8216;http_headers&#8217;] ) &gt; 0\n        ) {\n            $curl_opt[CURLOPT_HTTPHEADER] = $opt[&#8216;http_headers&#8217;];\n        }\n        if ( $opt[&#8216;verify_ssl&#8217;] === FALSE ) {\n            $curl_opt[CURLOPT_SSL_VERIFYPEER] = FALSE;\n            $curl_opt[CURLOPT_SSL_VERIFYHOST] = 0;\n        }\n        $curl = curl_init( $url );\n        curl_setopt_array( $curl, $curl_opt );\n        $body       = curl_exec( $curl );\n        $err_no     = curl_errno( $curl );\n        $err_msg    = curl_error( $curl );\n        $info       = curl_getinfo( $curl );\n        curl_close( $curl );\n        $header_string = trim( substr( $body, 0, $info[&#8216;header_size&#8217;] ) );\n        $body = substr( $body, $info[&#8216;header_size&#8217;] );\n        if ( strpos( $header_string, &quot;rnrn&quot; ) !== FALSE ) {\n            $header_string = end( explode( &quot;rnrn&quot;, $header_string ) );\n            $header_string = str_replace( &quot;rn&quot;, &quot;n&quot;, $header_string );\n        }\n        foreach ( explode( &quot;n&quot;, $header_string ) as $line ) {\n            list( $k, $v ) = explode( &#8216;:&#8217;, $line, 2 );\n            if ( empty( $v ) ) {\n                continue;\n            }\n            if ( strtolower( $k ) == &#8216;set-cookie&#8217; ) {\n                $cookies[] = trim( $v );\n            } else {\n                $headers[$k] = trim( $v );\n            }\n        }\n        return array(\n            &#8216;body&#8217;      =&gt; $body,\n            &#8216;err_no&#8217;    =&gt; $err_no,\n            &#8216;err_msg&#8217;   =&gt; $err_msg,\n            &#8216;headers&#8217;   =&gt; $headers,\n            &#8216;cookies&#8217;   =&gt; $cookies,\n            &#8216;info&#8217;      =&gt; $info\n        );\n    } // function curl_http_request\n}\n[/sourcecode]\nIt&#8217;s a bit longer that then other PHP Helper functions  .",
            "date_published": "2010-03-17T15:07:18-06:00",
            "date_modified": "2010-03-17T15:07:18-06:00",
            "authors": [
                {
                    "name": "josephscott",
                    "url": "https://blog.josephscott.org/author/josephscott/",
                    "avatar": "https://secure.gravatar.com/avatar/582b66ad5ae1b69c7601a990cb9a661a?s=512&d=mm&r=g"
                }
            ],
            "author": {
                "name": "josephscott",
                "url": "https://blog.josephscott.org/author/josephscott/",
                "avatar": "https://secure.gravatar.com/avatar/582b66ad5ae1b69c7601a990cb9a661a?s=512&d=mm&r=g"
            },
            "tags": [
                "curl",
                "curl_http_request",
                "PHP",
                "php-helpers",
                "Posts"
            ]
        }
    ]
}