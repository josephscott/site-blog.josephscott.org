{
    "version": "https://jsonfeed.org/version/1.1",
    "user_comment": "This feed allows you to read the posts from this site in any feed reader that supports the JSON Feed format. To add this feed to your reader, copy the following URL -- https://blog.josephscott.org/tag/user-agent/feed/json/ -- and add it your reader.",
    "home_page_url": "https://blog.josephscott.org/tag/user-agent/",
    "feed_url": "https://blog.josephscott.org/tag/user-agent/feed/json/",
    "language": "en-US",
    "title": "user-agent &#8211; Joseph Scott",
    "items": [
        {
            "id": "http://josephscott.org/?p=3081",
            "url": "https://blog.josephscott.org/2010/11/01/user-agent-sniffing-at-google-libraries-cdn/",
            "title": "User Agent Sniffing at Google Libraries CDN",
            "content_html": "<p>I recently took a closer look at <a href=\"http://code.google.com/apis/libraries/\">Google Libraries</a>, their content delivery network (CDN) for various Javascript libraries, and HTTP compression.  I started with a simple test:</p>\n<p>[sourcecode syn=&#8221;plain&#8221;]<br />\ncurl -O -v &#8211;compressed http://ajax.googleapis.com/ajax/libs/jquery/1.4.3/jquery.min.js<br />\n[/sourcecode]</p>\n<p>This downloads a minified version of jQuery 1.4.3, with <code>--compressed</code>, which means I&#8217;d like the response to be compressed.  The HTTP request looked like:</p>\n<p>[sourcecode syn=&#8221;plain&#8221;]<br />\n&gt; GET /ajax/libs/jquery/1.4.3/jquery.min.js HTTP/1.1<br />\n&gt; User-Agent: curl/7.16.4 (i386-apple-darwin9.0) libcurl/7.16.4 OpenSSL/0.9.7l zlib/1.2.3<br />\n&gt; Host: ajax.googleapis.com<br />\n&gt; Accept: */*<br />\n&gt; Accept-Encoding: deflate, gzip<br />\n&gt;<br />\n[/sourcecode]</p>\n<p>The  response from Google was:</p>\n<p>[sourcecode syn=&#8221;plain&#8221;]<br />\n&lt; HTTP/1.1 200 OK<br />\n&lt; Content-Type: text/javascript; charset=UTF-8<br />\n&lt; Last-Modified: Fri, 15 Oct 2010 18:25:24 GMT<br />\n&lt; Date: Fri, 29 Oct 2010 03:27:16 GMT<br />\n&lt; Expires: Sat, 29 Oct 2011 03:27:16 GMT<br />\n&lt; Vary: Accept-Encoding<br />\n&lt; X-Content-Type-Options: nosniff<br />\n&lt; Server: sffe<br />\n&lt; Cache-Control: public, max-age=31536000<br />\n&lt; Age: 145355<br />\n&lt; Transfer-Encoding: chunked<br />\n&lt;<br />\n[/sourcecode]</p>\n<p>I was surprised that there was no <code>Content-Encoding: gzip</code> header in the response, meaning the response was NOT compressed.  I wasn&#8217;t quite sure what to make of this at first.  No way would Google forget to turn on HTTP compression, I must have missed something.  I stared at the HTTP response for sometime, trying to figure out what I was missing.  Nothing came to mind, so  I ran another test.</p>\n<p>This time I made a request for http://ajax.googleapis.com/ajax/libs/jquery/1.4.3/jquery.min.js in Firefox 3.6.12 on Mac OS X and used Firebug to inspect the HTTP transaction.  The request:</p>\n<p>[sourcecode lang=&#8221;plain&#8221;]<br />\nGET /ajax/libs/jquery/1.4.3/jquery.min.js HTTP/1.1<br />\nHost: ajax.googleapis.com<br />\nUser-Agent: Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10.5; en-US; rv:1.9.2.12) Gecko/20101026 Firefox/3.6.12<br />\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8<br />\nAccept-Language: en-us,en;q=0.5<br />\nAccept-Encoding: gzip,deflate<br />\nAccept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.7<br />\nKeep-Alive: 115<br />\nConnection: keep-alive<br />\nPragma: no-cache<br />\nCache-Control: no-cache<br />\n[/sourcecode]</p>\n<p>and the response:</p>\n<p>[sourcecode lang=&#8221;plain&#8221;]<br />\nHTTP/1.1 200 OK<br />\nContent-Type: text/javascript; charset=UTF-8<br />\nLast-Modified: Fri, 15 Oct 2010 18:25:24 GMT<br />\nDate: Fri, 29 Oct 2010 03:12:35 GMT<br />\nExpires: Sat, 29 Oct 2011 03:12:35 GMT<br />\nVary: Accept-Encoding<br />\nX-Content-Type-Options: nosniff<br />\nServer: sffe<br />\nContent-Encoding: gzip<br />\nCache-Control: public, max-age=31536000<br />\nContent-Length: 26769<br />\nAge: 147128<br />\n[/sourcecode]</p>\n<p>This time the content was compressed.  There were several differences in the request headers between curl and Firefox, I decided to start with just one, the &#8220;User-Agent&#8221;.  I modified my initial curl request to include the User-Agent string from Firefox:</p>\n<p>[sourcecode syn=&#8221;plain&#8221;]<br />\ncurl -O -v &#8211;compressed &#8211;user-agent &quot;Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10.5; en-US; rv:1.9.2.12) Gecko/20101026 Firefox/3.6.12&quot; http://ajax.googleapis.com/ajax/libs/jquery/1.4.3/jquery.min.js<br />\n[/sourcecode]</p>\n<p>The request:</p>\n<p>[sourcecode syn=&#8221;plain&#8221;]<br />\n&gt; GET /ajax/libs/jquery/1.4.3/jquery.min.js HTTP/1.1<br />\n&gt; User-Agent: Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10.5; en-US; rv:1.9.2.12) Gecko/20101026 Firefox/3.6.12<br />\n&gt; Host: ajax.googleapis.com<br />\n&gt; Accept: */*<br />\n&gt; Accept-Encoding: deflate, gzip<br />\n&gt;<br />\n[/sourcecode]</p>\n<p>and the response:</p>\n<p>[sourcecode syn=&#8221;plain&#8221;]<br />\n&lt; HTTP/1.1 200 OK<br />\n&lt; Content-Type: text/javascript; charset=UTF-8<br />\n&lt; Last-Modified: Fri, 15 Oct 2010 18:25:24 GMT<br />\n&lt; Date: Fri, 29 Oct 2010 03:33:09 GMT<br />\n&lt; Expires: Sat, 29 Oct 2011 03:33:09 GMT<br />\n&lt; Vary: Accept-Encoding<br />\n&lt; X-Content-Type-Options: nosniff<br />\n&lt; Server: sffe<br />\n&lt; Content-Encoding: gzip<br />\n&lt; Cache-Control: public, max-age=31536000<br />\n&lt; Content-Length: 26769<br />\n&lt; Age: 147018<br />\n&lt;<br />\n[/sourcecode]</p>\n<p>Sure enough, I got back a compressed response.  Google was sniffing the User-Agent string to determine if a compressed response should be sent.  It didn&#8217;t matter if the client asked for a compressed response ( <code>Accept-Encoding: deflate, gzip</code>) or not.  What still wasn&#8217;t clear is if this was a black list approach (singling out curl) or a white list approach (Firefox is okay).  So I tried a few other requests with various User-Agent strings.  First up, no User-Agent set at all:</p>\n<p>[sourcecode syn=&#8221;plain&#8221;]<br />\ncurl -O -v &#8211;compressed &#8211;user-agent &quot;&quot; http://ajax.googleapis.com/ajax/libs/jquery/1.4.3/jquery.min.js<br />\n[/sourcecode]</p>\n<p>Not compressed.  Next a made up string:</p>\n<p>[sourcecode syn=&#8221;plain&#8221;]<br />\ncurl -O -v &#8211;compressed &#8211;user-agent &quot;JosephScott/1.0 test/2.0&quot; http://ajax.googleapis.com/ajax/libs/jquery/1.4.3/jquery.min.js<br />\n[/sourcecode]</p>\n<p>Not compressed.  At this point I think Google is using a white list approach, if you aren&#8217;t on the list of approved User-Agent strings for getting a compressed response then you won&#8217;t get one, no matter how nicely you ask.</p>\n<p>I collected a few more browser samples as well, just to be sure:</p>\n<ul>\n<li>Safari 5.0.2 on Mac OS X &#8211; compressed</li>\n<li>IE 8 on Windows XP &#8211; compressed</li>\n<li>Firefox 3.6.12 on Windows XP &#8211; compressed</li>\n<li>Chrome 7.0.517.41 beta on Windows XP &#8211; compressed</li>\n<li>Opera 10.63 on Windows XP &#8211; NOT compressed</li>\n<li>Safari 5.0.2 on Windows XP &#8211; compressed</li>\n</ul>\n<p>One more time, curl using the IE 8 User-Agent string:</p>\n<p>[sourcecode syn=&#8221;plain&#8221;]<br />\ncurl -O -v &#8211;compressed &#8211;user-agent &quot;Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 5.1; Trident/4.0; .NET4.0C;&quot; http://ajax.googleapis.com/ajax/libs/jquery/1.4.3/jquery.min.js<br />\n[/sourcecode]</p>\n<p>Compressed.</p>\n<p>Since I can manipulate the response based on the User-Agent value I&#8217;m left to conclude that the Google Library CDN sniffs the User-Agent string to determine if it will respond with a compressed result.  From what I&#8217;ve seen so far Google Library contains a white list of approved User-Agent patterns that it checks against to determine if it will honor the compression request.</p>\n<p>If you are on a current version of one of the popular browsers you will get a compressed response.  For those using anything else you&#8217;ll have to test to confirm if Google Library will honor your request for compressed content.  Opera users are just plain out of luck, even the most recent version gets an uncompressed response.</p>\n",
            "content_text": "I recently took a closer look at Google Libraries, their content delivery network (CDN) for various Javascript libraries, and HTTP compression.  I started with a simple test:\n[sourcecode syn=&#8221;plain&#8221;]\ncurl -O -v &#8211;compressed http://ajax.googleapis.com/ajax/libs/jquery/1.4.3/jquery.min.js\n[/sourcecode]\nThis downloads a minified version of jQuery 1.4.3, with --compressed, which means I&#8217;d like the response to be compressed.  The HTTP request looked like:\n[sourcecode syn=&#8221;plain&#8221;]\n&gt; GET /ajax/libs/jquery/1.4.3/jquery.min.js HTTP/1.1\n&gt; User-Agent: curl/7.16.4 (i386-apple-darwin9.0) libcurl/7.16.4 OpenSSL/0.9.7l zlib/1.2.3\n&gt; Host: ajax.googleapis.com\n&gt; Accept: */*\n&gt; Accept-Encoding: deflate, gzip\n&gt;\n[/sourcecode]\nThe  response from Google was:\n[sourcecode syn=&#8221;plain&#8221;]\n&lt; HTTP/1.1 200 OK\n&lt; Content-Type: text/javascript; charset=UTF-8\n&lt; Last-Modified: Fri, 15 Oct 2010 18:25:24 GMT\n&lt; Date: Fri, 29 Oct 2010 03:27:16 GMT\n&lt; Expires: Sat, 29 Oct 2011 03:27:16 GMT\n&lt; Vary: Accept-Encoding\n&lt; X-Content-Type-Options: nosniff\n&lt; Server: sffe\n&lt; Cache-Control: public, max-age=31536000\n&lt; Age: 145355\n&lt; Transfer-Encoding: chunked\n&lt;\n[/sourcecode]\nI was surprised that there was no Content-Encoding: gzip header in the response, meaning the response was NOT compressed.  I wasn&#8217;t quite sure what to make of this at first.  No way would Google forget to turn on HTTP compression, I must have missed something.  I stared at the HTTP response for sometime, trying to figure out what I was missing.  Nothing came to mind, so  I ran another test.\nThis time I made a request for http://ajax.googleapis.com/ajax/libs/jquery/1.4.3/jquery.min.js in Firefox 3.6.12 on Mac OS X and used Firebug to inspect the HTTP transaction.  The request:\n[sourcecode lang=&#8221;plain&#8221;]\nGET /ajax/libs/jquery/1.4.3/jquery.min.js HTTP/1.1\nHost: ajax.googleapis.com\nUser-Agent: Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10.5; en-US; rv:1.9.2.12) Gecko/20101026 Firefox/3.6.12\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\nAccept-Language: en-us,en;q=0.5\nAccept-Encoding: gzip,deflate\nAccept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.7\nKeep-Alive: 115\nConnection: keep-alive\nPragma: no-cache\nCache-Control: no-cache\n[/sourcecode]\nand the response:\n[sourcecode lang=&#8221;plain&#8221;]\nHTTP/1.1 200 OK\nContent-Type: text/javascript; charset=UTF-8\nLast-Modified: Fri, 15 Oct 2010 18:25:24 GMT\nDate: Fri, 29 Oct 2010 03:12:35 GMT\nExpires: Sat, 29 Oct 2011 03:12:35 GMT\nVary: Accept-Encoding\nX-Content-Type-Options: nosniff\nServer: sffe\nContent-Encoding: gzip\nCache-Control: public, max-age=31536000\nContent-Length: 26769\nAge: 147128\n[/sourcecode]\nThis time the content was compressed.  There were several differences in the request headers between curl and Firefox, I decided to start with just one, the &#8220;User-Agent&#8221;.  I modified my initial curl request to include the User-Agent string from Firefox:\n[sourcecode syn=&#8221;plain&#8221;]\ncurl -O -v &#8211;compressed &#8211;user-agent &quot;Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10.5; en-US; rv:1.9.2.12) Gecko/20101026 Firefox/3.6.12&quot; http://ajax.googleapis.com/ajax/libs/jquery/1.4.3/jquery.min.js\n[/sourcecode]\nThe request:\n[sourcecode syn=&#8221;plain&#8221;]\n&gt; GET /ajax/libs/jquery/1.4.3/jquery.min.js HTTP/1.1\n&gt; User-Agent: Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10.5; en-US; rv:1.9.2.12) Gecko/20101026 Firefox/3.6.12\n&gt; Host: ajax.googleapis.com\n&gt; Accept: */*\n&gt; Accept-Encoding: deflate, gzip\n&gt;\n[/sourcecode]\nand the response:\n[sourcecode syn=&#8221;plain&#8221;]\n&lt; HTTP/1.1 200 OK\n&lt; Content-Type: text/javascript; charset=UTF-8\n&lt; Last-Modified: Fri, 15 Oct 2010 18:25:24 GMT\n&lt; Date: Fri, 29 Oct 2010 03:33:09 GMT\n&lt; Expires: Sat, 29 Oct 2011 03:33:09 GMT\n&lt; Vary: Accept-Encoding\n&lt; X-Content-Type-Options: nosniff\n&lt; Server: sffe\n&lt; Content-Encoding: gzip\n&lt; Cache-Control: public, max-age=31536000\n&lt; Content-Length: 26769\n&lt; Age: 147018\n&lt;\n[/sourcecode]\nSure enough, I got back a compressed response.  Google was sniffing the User-Agent string to determine if a compressed response should be sent.  It didn&#8217;t matter if the client asked for a compressed response ( Accept-Encoding: deflate, gzip) or not.  What still wasn&#8217;t clear is if this was a black list approach (singling out curl) or a white list approach (Firefox is okay).  So I tried a few other requests with various User-Agent strings.  First up, no User-Agent set at all:\n[sourcecode syn=&#8221;plain&#8221;]\ncurl -O -v &#8211;compressed &#8211;user-agent &quot;&quot; http://ajax.googleapis.com/ajax/libs/jquery/1.4.3/jquery.min.js\n[/sourcecode]\nNot compressed.  Next a made up string:\n[sourcecode syn=&#8221;plain&#8221;]\ncurl -O -v &#8211;compressed &#8211;user-agent &quot;JosephScott/1.0 test/2.0&quot; http://ajax.googleapis.com/ajax/libs/jquery/1.4.3/jquery.min.js\n[/sourcecode]\nNot compressed.  At this point I think Google is using a white list approach, if you aren&#8217;t on the list of approved User-Agent strings for getting a compressed response then you won&#8217;t get one, no matter how nicely you ask.\nI collected a few more browser samples as well, just to be sure:\n\nSafari 5.0.2 on Mac OS X &#8211; compressed\nIE 8 on Windows XP &#8211; compressed\nFirefox 3.6.12 on Windows XP &#8211; compressed\nChrome 7.0.517.41 beta on Windows XP &#8211; compressed\nOpera 10.63 on Windows XP &#8211; NOT compressed\nSafari 5.0.2 on Windows XP &#8211; compressed\n\nOne more time, curl using the IE 8 User-Agent string:\n[sourcecode syn=&#8221;plain&#8221;]\ncurl -O -v &#8211;compressed &#8211;user-agent &quot;Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 5.1; Trident/4.0; .NET4.0C;&quot; http://ajax.googleapis.com/ajax/libs/jquery/1.4.3/jquery.min.js\n[/sourcecode]\nCompressed.\nSince I can manipulate the response based on the User-Agent value I&#8217;m left to conclude that the Google Library CDN sniffs the User-Agent string to determine if it will respond with a compressed result.  From what I&#8217;ve seen so far Google Library contains a white list of approved User-Agent patterns that it checks against to determine if it will honor the compression request.\nIf you are on a current version of one of the popular browsers you will get a compressed response.  For those using anything else you&#8217;ll have to test to confirm if Google Library will honor your request for compressed content.  Opera users are just plain out of luck, even the most recent version gets an uncompressed response.",
            "date_published": "2010-11-01T09:06:26-06:00",
            "date_modified": "2010-11-01T09:06:26-06:00",
            "authors": [
                {
                    "name": "josephscott",
                    "url": "https://blog.josephscott.org/author/josephscott/",
                    "avatar": "https://secure.gravatar.com/avatar/582b66ad5ae1b69c7601a990cb9a661a?s=512&d=mm&r=g"
                }
            ],
            "author": {
                "name": "josephscott",
                "url": "https://blog.josephscott.org/author/josephscott/",
                "avatar": "https://secure.gravatar.com/avatar/582b66ad5ae1b69c7601a990cb9a661a?s=512&d=mm&r=g"
            },
            "tags": [
                "cdn",
                "compression",
                "google",
                "http",
                "javascript",
                "user-agent",
                "Posts"
            ]
        }
    ]
}