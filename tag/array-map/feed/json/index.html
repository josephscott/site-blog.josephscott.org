{
    "version": "https://jsonfeed.org/version/1.1",
    "user_comment": "This feed allows you to read the posts from this site in any feed reader that supports the JSON Feed format. To add this feed to your reader, copy the following URL -- https://blog.josephscott.org/tag/array-map/feed/json/ -- and add it your reader.",
    "home_page_url": "https://blog.josephscott.org/tag/array-map/",
    "feed_url": "https://blog.josephscott.org/tag/array-map/feed/json/",
    "language": "en-US",
    "title": "array-map &#8211; Joseph Scott",
    "items": [
        {
            "id": "https://josephscott.org/?p=10941",
            "url": "https://blog.josephscott.org/2014/08/28/php-array_map-callback-expects-the-full-namespace/",
            "title": "PHP array_map Callback Expects The Full Namespace",
            "content_html": "<p>The <a href=\"http://php.net/manual/en/function.array-map.php\">array_map</a> function in PHP has a quirk ( I know, shocker ) that I&#8217;ve managed to forget several times.  Hopefully writing it here will cement it in my memory.</p>\n<p>Using <code>array_map</code> isn&#8217;t hard, here is a very contrived example:</p>\n<p>[sourcecode lang=&#8221;php&#8221;]<br />\nnamespace EXAMPLE;</p>\n<p>function lowercase_string( $name ) {<br />\n    return strtolower( $name );<br />\n}</p>\n<p>function lowercase_array( $names ) {<br />\n    return array_map( &#8216;lowercase_string&#8217;, $names );<br />\n}</p>\n<p>print_r( lowercase_array( [<br />\n    &#8216;Bill&#8217;,<br />\n    &#8216;Max&#8217;,<br />\n    &#8216;Julie&#8217;,<br />\n    &#8216;Norm&#8217;<br />\n] ) );<br />\necho &quot;n&quot;;<br />\n[/sourcecode]</p>\n<p>You feed an array to <code>lowercase_array()</code> and it will return lower cased versions of all the array entries.  Do you know what happens when you run this code?</p>\n<p>[sourcecode lang=&#8221;plain&#8221;]<br />\nPHP Warning:  array_map() expects parameter 1<br />\nto be a valid callback, function &#8216;lowercase_string&#8217;<br />\nnot found or invalid function name in<br />\n/home/josephscott/tmp/array-map.php on line 9<br />\n[/sourcecode]</p>\n<p>( I broke this up into multiple lines to make it easier to read )</p>\n<p>How can <code>lowercase_string</code> not be a valid callback? It is even defined right there in the same file.  The answer to this question is in the very first line of my example.</p>\n<p>When using <code>array_map()</code> inside of a <a href=\"http://php.net/manual/en/language.namespaces.php\">namespace</a> you must provide the full namespace reference to the callback.  In this case that means replacing <code>lowercase_string</code> with <code>EXAMPLElowercase_string</code>:</p>\n<p>[sourcecode lang=&#8221;php&#8221;]<br />\nnamespace EXAMPLE;</p>\n<p>function lowercase_string( $name ) {<br />\n    return strtolower( $name );<br />\n}</p>\n<p>function lowercase_array( $names ) {<br />\n    return array_map( &#8216;EXAMPLElowercase_string&#8217;, $names );<br />\n}</p>\n<p>print_r( lowercase_array( [<br />\n    &#8216;Bill&#8217;,<br />\n    &#8216;Max&#8217;,<br />\n    &#8216;Julie&#8217;,<br />\n    &#8216;Norm&#8217;<br />\n] ) );<br />\necho &quot;n&quot;;<br />\n[/sourcecode]</p>\n<p>Running this corrected version gives us what we&#8217;d expect:</p>\n<p>[sourcecode lang=&#8221;plain&#8221;]<br />\nArray<br />\n(<br />\n    [0] =&gt; bill<br />\n    [1] =&gt; max<br />\n    [2] =&gt; julie<br />\n    [3] =&gt; norm<br />\n)<br />\n[/sourcecode]</p>\n<p>I think the reason that I keep forgetting this is because it feels more obvious that <code>array_map()</code> should know it is already in a namespace and try to dereference the callback based on that namespace first, the same way a regular function call would.  This feels like a violation of the <a href=\"http://en.wikipedia.org/wiki/Principle_of_least_astonishment\">principle of least astonishment (POLA)</a>.</p>\n<p>While the <a href=\"http://php.net/manual/en/function.array-map.php\">array_map()</a> documentation makes no mention of the namespace requirement for the callback, it does appear to be the intended behavior.  A <a href=\"https://bugs.php.net/bug.php?id=54509\">PHP bug</a> was filed describing this exact issue.  It was closed as &#8220;this is not a bug&#8221;.</p>\n",
            "content_text": "The array_map function in PHP has a quirk ( I know, shocker ) that I&#8217;ve managed to forget several times.  Hopefully writing it here will cement it in my memory.\nUsing array_map isn&#8217;t hard, here is a very contrived example:\n[sourcecode lang=&#8221;php&#8221;]\nnamespace EXAMPLE;\nfunction lowercase_string( $name ) {\n    return strtolower( $name );\n}\nfunction lowercase_array( $names ) {\n    return array_map( &#8216;lowercase_string&#8217;, $names );\n}\nprint_r( lowercase_array( [\n    &#8216;Bill&#8217;,\n    &#8216;Max&#8217;,\n    &#8216;Julie&#8217;,\n    &#8216;Norm&#8217;\n] ) );\necho &quot;n&quot;;\n[/sourcecode]\nYou feed an array to lowercase_array() and it will return lower cased versions of all the array entries.  Do you know what happens when you run this code?\n[sourcecode lang=&#8221;plain&#8221;]\nPHP Warning:  array_map() expects parameter 1\nto be a valid callback, function &#8216;lowercase_string&#8217;\nnot found or invalid function name in\n/home/josephscott/tmp/array-map.php on line 9\n[/sourcecode]\n( I broke this up into multiple lines to make it easier to read )\nHow can lowercase_string not be a valid callback? It is even defined right there in the same file.  The answer to this question is in the very first line of my example.\nWhen using array_map() inside of a namespace you must provide the full namespace reference to the callback.  In this case that means replacing lowercase_string with EXAMPLElowercase_string:\n[sourcecode lang=&#8221;php&#8221;]\nnamespace EXAMPLE;\nfunction lowercase_string( $name ) {\n    return strtolower( $name );\n}\nfunction lowercase_array( $names ) {\n    return array_map( &#8216;EXAMPLElowercase_string&#8217;, $names );\n}\nprint_r( lowercase_array( [\n    &#8216;Bill&#8217;,\n    &#8216;Max&#8217;,\n    &#8216;Julie&#8217;,\n    &#8216;Norm&#8217;\n] ) );\necho &quot;n&quot;;\n[/sourcecode]\nRunning this corrected version gives us what we&#8217;d expect:\n[sourcecode lang=&#8221;plain&#8221;]\nArray\n(\n    [0] =&gt; bill\n    [1] =&gt; max\n    [2] =&gt; julie\n    [3] =&gt; norm\n)\n[/sourcecode]\nI think the reason that I keep forgetting this is because it feels more obvious that array_map() should know it is already in a namespace and try to dereference the callback based on that namespace first, the same way a regular function call would.  This feels like a violation of the principle of least astonishment (POLA).\nWhile the array_map() documentation makes no mention of the namespace requirement for the callback, it does appear to be the intended behavior.  A PHP bug was filed describing this exact issue.  It was closed as &#8220;this is not a bug&#8221;.",
            "date_published": "2014-08-28T21:27:49-06:00",
            "date_modified": "2014-08-28T21:27:49-06:00",
            "authors": [
                {
                    "name": "josephscott",
                    "url": "https://blog.josephscott.org/author/josephscott/",
                    "avatar": "https://secure.gravatar.com/avatar/582b66ad5ae1b69c7601a990cb9a661a?s=512&d=mm&r=g"
                }
            ],
            "author": {
                "name": "josephscott",
                "url": "https://blog.josephscott.org/author/josephscott/",
                "avatar": "https://secure.gravatar.com/avatar/582b66ad5ae1b69c7601a990cb9a661a?s=512&d=mm&r=g"
            },
            "tags": [
                "array-map",
                "callback",
                "namespace",
                "PHP",
                "Posts"
            ]
        }
    ]
}